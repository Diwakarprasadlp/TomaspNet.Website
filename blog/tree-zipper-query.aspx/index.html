<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8">
  <title>Processing trees with F# zipper computation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="One of the less frequently advertised new features in F# 3.0 is the query syntax. It allows adding custom operations to a computation expression block. This article shows how to define a custom computation for processing trees using zippers. We'll add navigation over a tree as custom operations to get a simple syntax. ">
  <meta name="author" content="Tomas Petricek">

  <!-- Reference Foundation -->
  <link rel="stylesheet" href="http://tomasp.net/css/foundation.css">
  <script src="js/vendor/custom.modernizr.js"></script>

  <link rel="alternate" type="application/rss+xml" href="http://tomasp.net/rss.xml" title="RSS feed for Tomas Petricek's blog">
  <link rel="icon" type="image/png" href="http://tomasp.net/img/favicon.png" />
    
  <!-- Reference custom CSS and tooltips -->
  <link type="text/css" rel="stylesheet" href="http://tomasp.net/custom/style.css" />
  <script type="text/javascript" src="http://tomasp.net/custom/tooltips.js"></script>
  <link type="text/css" rel="stylesheet" href="http://tomasp.net/custom/tooltips.css" />
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@tomaspetricek">
  <meta name="twitter:title" content="Processing trees with F# zipper computation">
  <meta name="twitter:description" content="One of the less frequently advertised new features in F# 3.0 is the query syntax. It allows adding custom operations to a computation expression block. This article shows how to define a custom computation for processing trees using zippers. We'll add navigation over a tree as custom operations to get a simple syntax. ">
</head>
<body>

   <header id="top-header">
    <div class="row">
      <div class="twelve columns">
        <h1><a href="http://tomasp.net/">Tomas Petricek's blog</a></h1>
        <p>Writing about practical F# coding and programming language research</p>
      </div>
    </div>
  </header>

  <header class="top-bar-header">
    <div class="contain-to-grid sticky">
    <nav class="top-bar">

    <ul class="title-area">
      <li class="name"><h1><a href="#"></a></h1></li>
      <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
    </ul>
    <section class="top-bar-section">
      <ul class="right">
        <li><a href="http://tomasp.net/blog/index.html">Blog</a></li>
        <li><a href="http://functional-programming.net">Books</a></li>
        <li><a href="http://fsharpworks.com/workshops.html">Trainings</a></li>
        <li><a href="http://fsharpworks.com">Consulting</a></li>
        <li><a href="http://tomasp.net/academic">Research</a></li>
      </ul>
    </section>

    </nav></div>
  </header>
  
  
<div class="row">
	<div class="large-8 columns main-content">
    <content>
      

<h1>Processing trees with F# zipper computation</h1>

<p>One of the less frequently advertised new features in F# 3.0 is the <em>query syntax</em>.
It is an extension that makes it possible to add custom operations in an F#
computation expression. The standard <code>query { .. }</code> computation uses this to define
operations such as sorting (<code>sortBy</code> and <code>sortByDescending</code>) or operations for taking
and skipping elements (<code>take</code>, <code>takeWhile</code>, ...). For example, you can write:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">query</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">x</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="k">take</span> <span class="n">3</span>
        <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="k">sortByDescending</span> <span onmouseout="hideTip(event, 'fs2', 5)" onmouseover="showTip(event, 'fs2', 5)" class="i">x</span> }</pre>
</td>
</tr>
</table>

<p>In this article I'll use the same notation for processing trees using the <em>zipper</em>
pattern. I'll show how to define a computation that allows you to traverse a tree
and perform transformations on (parts) of the tree. For example, we'll be able to 
say "Go to the left sub-tree, multiply all values by 2. Then go back and to the
right sub-tree and divide all values by 2" as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs53', 227)" onmouseover="showTip(event, 'fs53', 227)" class="i">tree</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs2', 228)" onmouseover="showTip(event, 'fs2', 228)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs32', 229)" onmouseover="showTip(event, 'fs32', 229)" class="i">sample</span> <span class="k">do</span>
       <span onmouseout="hideTip(event, 'fs64', 230)" onmouseover="showTip(event, 'fs64', 230)" class="k">left</span> 
       <span onmouseout="hideTip(event, 'fs66', 231)" onmouseover="showTip(event, 'fs66', 231)" class="k">map</span> (<span onmouseout="hideTip(event, 'fs2', 232)" onmouseover="showTip(event, 'fs2', 232)" class="i">x</span> <span class="o">*</span> <span class="n">2</span>) 
       <span onmouseout="hideTip(event, 'fs67', 233)" onmouseover="showTip(event, 'fs67', 233)" class="k">up</span>
       <span onmouseout="hideTip(event, 'fs63', 234)" onmouseover="showTip(event, 'fs63', 234)" class="k">right</span>
       <span onmouseout="hideTip(event, 'fs66', 235)" onmouseover="showTip(event, 'fs66', 235)" class="k">map</span> (<span onmouseout="hideTip(event, 'fs2', 236)" onmouseover="showTip(event, 'fs2', 236)" class="i">x</span> <span class="o">/</span> <span class="n">2</span>) 
       <span onmouseout="hideTip(event, 'fs68', 237)" onmouseover="showTip(event, 'fs68', 237)" class="k">top</span> }</pre>
</td>
</tr>
</table>

<p>This example behaves quite differently to the usual <code>query</code> computation. It mostly
relies on custom operations like <code>left</code>, <code>right</code> and <code>up</code> that allow us to navigate
through a tree (descend along the left or right sub-tree, go back to the parent node). 
The only operation that <em>does something</em> is the <code>map</code> operation which transforms the
current sub-tree.</p>

<p>This was just a brief introduction to what is possible, so let's take a detailed look
at how this works...</p>

<h2>Trees and zippers</h2>

<p>First of all, we need to define a data type that represents the tree. This is going
to be a standard binary tree with values in leafs (but you could do the similar
thing for other kinds of trees or structures):</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">Tree</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">Node</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs5', 8)" onmouseover="showTip(event, 'fs5', 8)" class="i">Tree</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs5', 9)" onmouseover="showTip(event, 'fs5', 9)" class="i">Tree</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>
  | <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">Leaf</span> <span class="k">of</span> <span class="o">&#39;</span><span class="i">T</span>
  <span class="k">override</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">ToString</span>() <span class="o">=</span> <span id="fst10" onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13, document.getElementById('fst10'))" class="omitted">(...)</span></pre>
</td>
</tr>
</table>

<p>Next, we need to look at the concept of a <em>zipper</em>. Intuitively, a zipper is something
that allows you to navigate through the tree. When you go the left sub-tree, we want
to get a value that contains this sub-tree together with the path that describes how
we got there (and contains remaining branches that are needed to reconstruct the original
tree when we go back up).</p>

<p>The <a href="http://www.st.cs.uni-saarland.de/edu/seminare/2005/advanced-fp/docs/huet-zipper.pdf" title="G. Huet: The Zipper (Journal of Functional Programming)">paper that introduced Zippers</a> is very readable and introduces the idea
in more details. As a fun fact, you can also read about how zippers can be derived
<a href="http://strictlypositive.org/diff.pdf" title="C. McBride: The Derivative of a Regular Type is its Type of One-Hole Contexts">automatically using <em>differentiation</em></a>.
In our case, the zipper data type for the tree is defined as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">Path</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="i">Top</span> 
  | <span onmouseout="hideTip(event, 'fs13', 16)" onmouseover="showTip(event, 'fs13', 16)" class="i">Left</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="i">Path</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs5', 18)" onmouseover="showTip(event, 'fs5', 18)" class="i">Tree</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>
  | <span onmouseout="hideTip(event, 'fs14', 19)" onmouseover="showTip(event, 'fs14', 19)" class="i">Right</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs11', 20)" onmouseover="showTip(event, 'fs11', 20)" class="i">Path</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs5', 21)" onmouseover="showTip(event, 'fs5', 21)" class="i">Tree</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>
  <span class="k">override</span> <span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 23)" onmouseover="showTip(event, 'fs16', 23)" class="i">ToString</span>() <span class="o">=</span> <span id="fst17" onmouseout="hideTip(event, 'fs17', 24)" onmouseover="showTip(event, 'fs17', 24, document.getElementById('fst17'))" class="omitted">(...)</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs18', 25)" onmouseover="showTip(event, 'fs18', 25)" class="i">TreeZipper</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs19', 26)" onmouseover="showTip(event, 'fs19', 26)" class="i">TZ</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs5', 27)" onmouseover="showTip(event, 'fs5', 27)" class="i">Tree</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs11', 28)" onmouseover="showTip(event, 'fs11', 28)" class="i">Path</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>
  <span class="k">override</span> <span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 30)" onmouseover="showTip(event, 'fs21', 30)" class="i">ToString</span>() <span class="o">=</span> <span id="fst22" onmouseout="hideTip(event, 'fs22', 31)" onmouseover="showTip(event, 'fs22', 31, document.getElementById('fst22'))" class="omitted">(...)</span></pre>
</td>
</tr>
</table>

<p>The <code>TreeZipper&lt;'T&gt;</code> type pairs a tree (the current sub-tree that we are focused at)
with a path which describes "how we got there". If we are at the root, then the path
is <code>Top</code>. If we descend to the left-sub tree, then the path is represented using 
<code>Left(path, tree)</code> where <code>path</code> is the previous path and <code>tree</code> is the tree on the
right (that we just skipped over).</p>

<h2>Working with zippers</h2>

<p>Let's look at three simple functions that operate on the tree zipper and then 
we'll navigate through a simple tree using them:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Navigates to the left sub-tree</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 32)" onmouseover="showTip(event, 'fs23', 32)" class="i">left</span> <span class="o">=</span> <span class="k">function</span>
  | <span onmouseout="hideTip(event, 'fs19', 33)" onmouseover="showTip(event, 'fs19', 33)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs7', 34)" onmouseover="showTip(event, 'fs7', 34)" class="i">Leaf</span> _, _) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs24', 35)" onmouseover="showTip(event, 'fs24', 35)" class="i">failwith</span> <span class="s">&quot;</span><span class="s">cannot</span><span class="s"> </span><span class="s">go</span><span class="s"> </span><span class="s">left</span><span class="s">&quot;</span>
  | <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs6', 37)" onmouseover="showTip(event, 'fs6', 37)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs25', 38)" onmouseover="showTip(event, 'fs25', 38)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs26', 39)" onmouseover="showTip(event, 'fs26', 39)" class="i">r</span>), <span onmouseout="hideTip(event, 'fs27', 40)" onmouseover="showTip(event, 'fs27', 40)" class="i">p</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs19', 41)" onmouseover="showTip(event, 'fs19', 41)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs25', 42)" onmouseover="showTip(event, 'fs25', 42)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs13', 43)" onmouseover="showTip(event, 'fs13', 43)" class="i">Left</span>(<span onmouseout="hideTip(event, 'fs27', 44)" onmouseover="showTip(event, 'fs27', 44)" class="i">p</span>, <span onmouseout="hideTip(event, 'fs26', 45)" onmouseover="showTip(event, 'fs26', 45)" class="i">r</span>))

<span class="c">/// Navigates to the right sub-tree</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 46)" onmouseover="showTip(event, 'fs28', 46)" class="i">right</span> <span class="o">=</span> <span class="k">function</span>
  | <span onmouseout="hideTip(event, 'fs19', 47)" onmouseover="showTip(event, 'fs19', 47)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs7', 48)" onmouseover="showTip(event, 'fs7', 48)" class="i">Leaf</span> _, _) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs24', 49)" onmouseover="showTip(event, 'fs24', 49)" class="i">failwith</span> <span class="s">&quot;</span><span class="s">cannot</span><span class="s"> </span><span class="s">go</span><span class="s"> </span><span class="s">right</span><span class="s">&quot;</span>
  | <span onmouseout="hideTip(event, 'fs19', 50)" onmouseover="showTip(event, 'fs19', 50)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs6', 51)" onmouseover="showTip(event, 'fs6', 51)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs25', 52)" onmouseover="showTip(event, 'fs25', 52)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs26', 53)" onmouseover="showTip(event, 'fs26', 53)" class="i">r</span>), <span onmouseout="hideTip(event, 'fs27', 54)" onmouseover="showTip(event, 'fs27', 54)" class="i">p</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs19', 55)" onmouseover="showTip(event, 'fs19', 55)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs26', 56)" onmouseover="showTip(event, 'fs26', 56)" class="i">r</span>, <span onmouseout="hideTip(event, 'fs14', 57)" onmouseover="showTip(event, 'fs14', 57)" class="i">Right</span>(<span onmouseout="hideTip(event, 'fs27', 58)" onmouseover="showTip(event, 'fs27', 58)" class="i">p</span>, <span onmouseout="hideTip(event, 'fs25', 59)" onmouseover="showTip(event, 'fs25', 59)" class="i">l</span>))

<span class="c">/// Gets the value at the current position</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 60)" onmouseover="showTip(event, 'fs29', 60)" class="i">current</span> <span class="o">=</span> <span class="k">function</span>
  | <span onmouseout="hideTip(event, 'fs19', 61)" onmouseover="showTip(event, 'fs19', 61)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs7', 62)" onmouseover="showTip(event, 'fs7', 62)" class="i">Leaf</span> <span onmouseout="hideTip(event, 'fs30', 63)" onmouseover="showTip(event, 'fs30', 63)" class="i">x</span>, _) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs30', 64)" onmouseover="showTip(event, 'fs30', 64)" class="i">x</span>
  | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs24', 65)" onmouseover="showTip(event, 'fs24', 65)" class="i">failwith</span> <span class="s">&quot;</span><span class="s">cannot</span><span class="s"> </span><span class="s">get</span><span class="s"> </span><span class="s">current</span><span class="s">&quot;</span></pre>
</td>
</tr>
</table>

<p>The <code>left</code> and <code>right</code> functions are symmetric. If the <code>TreeZipper&lt;'T&gt;</code> represents a 
position where the current tree is <code>Leaf</code> then they fail, because we cannot descend to
a sub-tree of a leaf. If the tree is a <code>Node</code> then they pick the left (or right) sub-tree
and make it a current tree by using it as the first argument of <code>TZ</code>. The path is
constructed by appending the other tree (<code>r</code> or <code>l</code>, respectively) to the previous
path using <code>Left</code> or <code>Right</code>.</p>

<p>On the other hand, the <code>current</code> operation only works when the zipper points at 
a leaf node. In that case, it simply returns the value from the leaf.
The following example defines a simple tree and then uses zipper operations to
get to one of the leaves in the tree:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// Create a sample tree</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 66)" onmouseover="showTip(event, 'fs31', 66)" class="i">branches</span> <span class="o">=</span> 
  <span onmouseout="hideTip(event, 'fs6', 67)" onmouseover="showTip(event, 'fs6', 67)" class="i">Node</span>( <span onmouseout="hideTip(event, 'fs6', 68)" onmouseover="showTip(event, 'fs6', 68)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs7', 69)" onmouseover="showTip(event, 'fs7', 69)" class="i">Leaf</span> <span class="n">1</span>, <span onmouseout="hideTip(event, 'fs7', 70)" onmouseover="showTip(event, 'fs7', 70)" class="i">Leaf</span> <span class="n">3</span>), 
        <span onmouseout="hideTip(event, 'fs6', 71)" onmouseover="showTip(event, 'fs6', 71)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs7', 72)" onmouseover="showTip(event, 'fs7', 72)" class="i">Leaf</span> <span class="n">7</span>, <span onmouseout="hideTip(event, 'fs6', 73)" onmouseover="showTip(event, 'fs6', 73)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs7', 74)" onmouseover="showTip(event, 'fs7', 74)" class="i">Leaf</span> <span class="n">12</span>, <span onmouseout="hideTip(event, 'fs7', 75)" onmouseover="showTip(event, 'fs7', 75)" class="i">Leaf</span> <span class="n">20</span>)) )

<span class="c">// Wrap it as a zipper &amp; print</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 76)" onmouseover="showTip(event, 'fs32', 76)" class="i">sample</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 77)" onmouseover="showTip(event, 'fs19', 77)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs31', 78)" onmouseover="showTip(event, 'fs31', 78)" class="i">branches</span>, <span onmouseout="hideTip(event, 'fs12', 79)" onmouseover="showTip(event, 'fs12', 79)" class="i">Top</span>)
<span onmouseout="hideTip(event, 'fs33', 80)" onmouseover="showTip(event, 'fs33', 80)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">O</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs32', 81)" onmouseover="showTip(event, 'fs32', 81)" class="i">sample</span> 

<span class="c">// Get one of the tree leaves</span>
<span onmouseout="hideTip(event, 'fs32', 82)" onmouseover="showTip(event, 'fs32', 82)" class="i">sample</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs28', 83)" onmouseover="showTip(event, 'fs28', 83)" class="i">right</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs28', 84)" onmouseover="showTip(event, 'fs28', 84)" class="i">right</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 85)" onmouseover="showTip(event, 'fs23', 85)" class="i">left</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs29', 86)" onmouseover="showTip(event, 'fs29', 86)" class="i">current</span></pre>
</td>
</tr>
</table>

<p>To make this example complete, we also need to add operation <code>up</code> that goes to the
parent. We will also need an operation that (recursively) goes back to the top of the tree:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// Navigate to the parent node</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 87)" onmouseover="showTip(event, 'fs34', 87)" class="i">up</span> <span class="o">=</span> <span class="k">function</span>
  | <span onmouseout="hideTip(event, 'fs19', 88)" onmouseover="showTip(event, 'fs19', 88)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs25', 89)" onmouseover="showTip(event, 'fs25', 89)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs13', 90)" onmouseover="showTip(event, 'fs13', 90)" class="i">Left</span>(<span onmouseout="hideTip(event, 'fs27', 91)" onmouseover="showTip(event, 'fs27', 91)" class="i">p</span>, <span onmouseout="hideTip(event, 'fs26', 92)" onmouseover="showTip(event, 'fs26', 92)" class="i">r</span>))
  | <span onmouseout="hideTip(event, 'fs19', 93)" onmouseover="showTip(event, 'fs19', 93)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs26', 94)" onmouseover="showTip(event, 'fs26', 94)" class="i">r</span>, <span onmouseout="hideTip(event, 'fs14', 95)" onmouseover="showTip(event, 'fs14', 95)" class="i">Right</span>(<span class="i">p</span>, <span class="i">l</span>)) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs19', 96)" onmouseover="showTip(event, 'fs19', 96)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs6', 97)" onmouseover="showTip(event, 'fs6', 97)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs25', 98)" onmouseover="showTip(event, 'fs25', 98)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs26', 99)" onmouseover="showTip(event, 'fs26', 99)" class="i">r</span>), <span onmouseout="hideTip(event, 'fs27', 100)" onmouseover="showTip(event, 'fs27', 100)" class="i">p</span>)
  | <span onmouseout="hideTip(event, 'fs19', 101)" onmouseover="showTip(event, 'fs19', 101)" class="i">TZ</span>(_, <span onmouseout="hideTip(event, 'fs12', 102)" onmouseover="showTip(event, 'fs12', 102)" class="i">Top</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs24', 103)" onmouseover="showTip(event, 'fs24', 103)" class="i">failwith</span> <span class="s">&quot;</span><span class="s">cannot</span><span class="s"> </span><span class="s">go</span><span class="s"> </span><span class="s">up</span><span class="s">&quot;</span>

<span class="c">// Navigate to the root of the tree</span>
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs35', 104)" onmouseover="showTip(event, 'fs35', 104)" class="i">top</span> <span class="o">=</span> <span class="k">function</span>
  | <span onmouseout="hideTip(event, 'fs19', 105)" onmouseover="showTip(event, 'fs19', 105)" class="i">TZ</span>(_, <span onmouseout="hideTip(event, 'fs12', 106)" onmouseover="showTip(event, 'fs12', 106)" class="i">Top</span>) <span class="k">as</span> <span onmouseout="hideTip(event, 'fs36', 107)" onmouseover="showTip(event, 'fs36', 107)" class="i">t</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 108)" onmouseover="showTip(event, 'fs36', 108)" class="i">t</span>
  | <span onmouseout="hideTip(event, 'fs37', 109)" onmouseover="showTip(event, 'fs37', 109)" class="i">tz</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs35', 110)" onmouseover="showTip(event, 'fs35', 110)" class="i">top</span> (<span onmouseout="hideTip(event, 'fs34', 111)" onmouseover="showTip(event, 'fs34', 111)" class="i">up</span> <span onmouseout="hideTip(event, 'fs37', 112)" onmouseover="showTip(event, 'fs37', 112)" class="i">tz</span>)</pre>
</td>
</tr>
</table>

<p>The <code>up</code> operation fails when we are already in the root and the path is just <code>Top</code>.
Otherwise, it gets the current tree and takes the other branch from the path value.
These two trees are combined into a new <code>Node</code> which is then returned as the current
tree.</p>

<h3>Adding computational operations</h3>

<p>In order to define an F# computation expression, we need to define the meaning of
<code>for</code> and <code>yield</code>. Most often, these operations are implemented by monadic <em>bind</em>
and <em>unit</em>. We will not follow this pattern exactly. If we did that, we wouldn't be
able to implement the motivating example as nicely.</p>

<p>The operations that we need to define are <code>unit</code>, which
simply creates a tree containing just a leaf, and <code>bindSub</code> which transforms
all leaves in the current sub-tree using a specified function:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Build tree zipper with singleton tree</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 113)" onmouseover="showTip(event, 'fs38', 113)" class="i">unit</span> <span onmouseout="hideTip(event, 'fs39', 114)" onmouseover="showTip(event, 'fs39', 114)" class="i">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 115)" onmouseover="showTip(event, 'fs19', 115)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs7', 116)" onmouseover="showTip(event, 'fs7', 116)" class="i">Leaf</span> <span onmouseout="hideTip(event, 'fs39', 117)" onmouseover="showTip(event, 'fs39', 117)" class="i">v</span>, <span onmouseout="hideTip(event, 'fs12', 118)" onmouseover="showTip(event, 'fs12', 118)" class="i">Top</span>)

<span class="c">/// Transform leaves in the current sub-tree of &#39;treeZip&#39;</span>
<span class="c">/// into other trees using the provided function &#39;f&#39;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 119)" onmouseover="showTip(event, 'fs40', 119)" class="i">bindSub</span> <span onmouseout="hideTip(event, 'fs41', 120)" onmouseover="showTip(event, 'fs41', 120)" class="i">f</span> <span onmouseout="hideTip(event, 'fs42', 121)" onmouseover="showTip(event, 'fs42', 121)" class="i">treeZip</span> <span class="o">=</span> 
  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs43', 122)" onmouseover="showTip(event, 'fs43', 122)" class="i">bindT</span> <span class="o">=</span> <span class="k">function</span>
    | <span onmouseout="hideTip(event, 'fs7', 123)" onmouseover="showTip(event, 'fs7', 123)" class="i">Leaf</span> <span onmouseout="hideTip(event, 'fs30', 124)" onmouseover="showTip(event, 'fs30', 124)" class="i">x</span> <span class="k">-&gt;</span> <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs19', 125)" onmouseover="showTip(event, 'fs19', 125)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs44', 126)" onmouseover="showTip(event, 'fs44', 126)" class="i">t</span>, _)) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs35', 127)" onmouseover="showTip(event, 'fs35', 127)" class="i">top</span> (<span onmouseout="hideTip(event, 'fs41', 128)" onmouseover="showTip(event, 'fs41', 128)" class="i">f</span> <span onmouseout="hideTip(event, 'fs30', 129)" onmouseover="showTip(event, 'fs30', 129)" class="i">x</span>) <span class="k">in</span> <span onmouseout="hideTip(event, 'fs44', 130)" onmouseover="showTip(event, 'fs44', 130)" class="i">t</span>
    | <span onmouseout="hideTip(event, 'fs6', 131)" onmouseover="showTip(event, 'fs6', 131)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs25', 132)" onmouseover="showTip(event, 'fs25', 132)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs26', 133)" onmouseover="showTip(event, 'fs26', 133)" class="i">r</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 134)" onmouseover="showTip(event, 'fs6', 134)" class="i">Node</span>(<span onmouseout="hideTip(event, 'fs43', 135)" onmouseover="showTip(event, 'fs43', 135)" class="i">bindT</span> <span onmouseout="hideTip(event, 'fs25', 136)" onmouseover="showTip(event, 'fs25', 136)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs43', 137)" onmouseover="showTip(event, 'fs43', 137)" class="i">bindT</span> <span onmouseout="hideTip(event, 'fs26', 138)" onmouseover="showTip(event, 'fs26', 138)" class="i">r</span>)
  <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs19', 139)" onmouseover="showTip(event, 'fs19', 139)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs45', 140)" onmouseover="showTip(event, 'fs45', 140)" class="i">current</span>, <span onmouseout="hideTip(event, 'fs46', 141)" onmouseover="showTip(event, 'fs46', 141)" class="i">path</span>)) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs42', 142)" onmouseover="showTip(event, 'fs42', 142)" class="i">treeZip</span>
  <span onmouseout="hideTip(event, 'fs19', 143)" onmouseover="showTip(event, 'fs19', 143)" class="i">TZ</span>(<span onmouseout="hideTip(event, 'fs43', 144)" onmouseover="showTip(event, 'fs43', 144)" class="i">bindT</span> <span onmouseout="hideTip(event, 'fs45', 145)" onmouseover="showTip(event, 'fs45', 145)" class="i">current</span>, <span onmouseout="hideTip(event, 'fs46', 146)" onmouseover="showTip(event, 'fs46', 146)" class="i">path</span>)</pre>
</td>
</tr>
</table>

<p>The type of <code>bindSub</code> is <code>('T -&gt; TreeZipper&lt;'T&gt;) -&gt; TreeZipper&lt;'T&gt; -&gt; TreeZipper&lt;'T&gt;</code>,
which is almost like monadic <em>bind</em> with the exception that the transformation function
needs to transform elements of type <code>'T</code> into trees containing leaves of <em>the same</em> type.</p>

<p>This requiremenet follows from the fact that we run the transformation only on the
current tree (<code>bindT current</code>) while the <code>path</code> is left unchanged (and since path contains
other trees of the same type, the type needs to stay the same). You could implement
<code>bind</code> that applies <code>f</code> to trees in the path, but that would not be as interesting
(because all transformations like <code>map</code> would happen on the whole tree - not just
the current sub-tree).</p>

<h2>Defining the Computation builder</h2>

<h3>Providing monadic operations</h3>

<p>Now we have everything we need to define an F# computation builder for working with 
tree zippers. We start with a simple definition that allows just <code>for</code> and <code>yield</code> 
and then add all the (interesting) custom operators. Our <code>yield</code> is defined as <code>unit</code>
and <code>for</code> corresponds to <code>bindSub</code>:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs47', 147)" onmouseover="showTip(event, 'fs47', 147)" class="i">TreeZipperBuilder</span>() <span class="o">=</span> 
  <span class="c">/// Enables the &#39;for x in xs do ..&#39; syntax</span>
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 148)" onmouseover="showTip(event, 'fs48', 148)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 149)" onmouseover="showTip(event, 'fs49', 149)" class="i">For</span>(<span onmouseout="hideTip(event, 'fs50', 150)" onmouseover="showTip(event, 'fs50', 150)" class="i">tz</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs18', 151)" onmouseover="showTip(event, 'fs18', 151)" class="i">TreeZipper</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>, <span onmouseout="hideTip(event, 'fs51', 152)" onmouseover="showTip(event, 'fs51', 152)" class="i">f</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs18', 153)" onmouseover="showTip(event, 'fs18', 153)" class="i">TreeZipper</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs40', 154)" onmouseover="showTip(event, 'fs40', 154)" class="i">bindSub</span> <span onmouseout="hideTip(event, 'fs51', 155)" onmouseover="showTip(event, 'fs51', 155)" class="i">f</span> <span onmouseout="hideTip(event, 'fs50', 156)" onmouseover="showTip(event, 'fs50', 156)" class="i">tz</span>
  <span class="c">/// Enables the &#39;yield x&#39; syntax</span>
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 157)" onmouseover="showTip(event, 'fs48', 157)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 158)" onmouseover="showTip(event, 'fs52', 158)" class="i">Yield</span>(<span onmouseout="hideTip(event, 'fs39', 159)" onmouseover="showTip(event, 'fs39', 159)" class="i">v</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 160)" onmouseover="showTip(event, 'fs38', 160)" class="i">unit</span> <span onmouseout="hideTip(event, 'fs39', 161)" onmouseover="showTip(event, 'fs39', 161)" class="i">v</span>

<span class="c">/// Global instance of the computation builder</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 162)" onmouseover="showTip(event, 'fs53', 162)" class="i">tree</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs47', 163)" onmouseover="showTip(event, 'fs47', 163)" class="i">TreeZipperBuilder</span>()</pre>
</td>
</tr>
</table>

<p>Equipped with the above definition, we can write computations that transform the
entire tree. For example, to multiply all values of the tree by 2, we can write
the following computation (you can pass the result to <code>printfn "%O"</code> to get a nicer
output)</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs53', 164)" onmouseover="showTip(event, 'fs53', 164)" class="i">tree</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs2', 165)" onmouseover="showTip(event, 'fs2', 165)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs32', 166)" onmouseover="showTip(event, 'fs32', 166)" class="i">sample</span> <span class="k">do</span>
       <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs2', 167)" onmouseover="showTip(event, 'fs2', 167)" class="i">x</span> <span class="o">*</span> <span class="n">2</span> }</pre>
</td>
</tr>
</table>

<p>As discussed earlier, the <code>bindSub</code> operation (and thus our <code>for</code>) only allows the
result to have the same type as the input. Writing, for example, <code>x.ToString()</code>, would
be invalid. In this case, it does not seem very logical, but that's because we have not
added operations for navigating through the tree - the <code>for</code> and <code>yield</code> can be
only used to transform the entire tree.</p>

<h3>Adding custom operations</h3>

<p>Now we're getting to the most interesting bit of the article. How do we add custom 
operations to the computation expression? To do that, we need to annotate the method
with <code>CustomOperation</code> attribute. The attribute defines the name of the operation
and can specify additional parameters.</p>

<p>The fact that makes custom operations interesting is that they can have types such 
as <code>TreeZipper&lt;'T&gt; -&gt; TreeZipper&lt;'T&gt;</code> which is exactly the type of our navigational
operations. The syntax allows other operations - such as zipping, grouping and
joinging - but we will not need these in this article.</p>

<p>To add navigational operations, transformations and getter for the current element,
we can write the following code:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs47', 168)" onmouseover="showTip(event, 'fs47', 168)" class="i">TreeZipperBuilder</span> <span class="k">with</span>
  <span class="c">// Operations for navigation through the tree</span>
  [&lt;<span onmouseout="hideTip(event, 'fs54', 169)" onmouseover="showTip(event, 'fs54', 169)" class="i">CustomOperation</span>(<span class="s">&quot;</span><span class="s">left</span><span class="s">&quot;</span>, <span class="i">MaintainsVariableSpace</span><span class="o">=</span><span class="k">true</span>)&gt;]
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 170)" onmouseover="showTip(event, 'fs48', 170)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs55', 171)" onmouseover="showTip(event, 'fs55', 171)" class="i">Left</span>(<span onmouseout="hideTip(event, 'fs37', 172)" onmouseover="showTip(event, 'fs37', 172)" class="i">tz</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs23', 173)" onmouseover="showTip(event, 'fs23', 173)" class="i">left</span> <span onmouseout="hideTip(event, 'fs37', 174)" onmouseover="showTip(event, 'fs37', 174)" class="i">tz</span>
  [&lt;<span onmouseout="hideTip(event, 'fs54', 175)" onmouseover="showTip(event, 'fs54', 175)" class="i">CustomOperation</span>(<span class="s">&quot;</span><span class="s">right</span><span class="s">&quot;</span>, <span class="i">MaintainsVariableSpace</span><span class="o">=</span><span class="k">true</span>)&gt;]
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 176)" onmouseover="showTip(event, 'fs48', 176)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 177)" onmouseover="showTip(event, 'fs56', 177)" class="i">Right</span>(<span onmouseout="hideTip(event, 'fs37', 178)" onmouseover="showTip(event, 'fs37', 178)" class="i">tz</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 179)" onmouseover="showTip(event, 'fs28', 179)" class="i">right</span> <span onmouseout="hideTip(event, 'fs37', 180)" onmouseover="showTip(event, 'fs37', 180)" class="i">tz</span>
  [&lt;<span onmouseout="hideTip(event, 'fs54', 181)" onmouseover="showTip(event, 'fs54', 181)" class="i">CustomOperation</span>(<span class="s">&quot;</span><span class="s">up</span><span class="s">&quot;</span>, <span class="i">MaintainsVariableSpace</span><span class="o">=</span><span class="k">true</span>)&gt;]
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 182)" onmouseover="showTip(event, 'fs48', 182)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs57', 183)" onmouseover="showTip(event, 'fs57', 183)" class="i">Up</span>(<span onmouseout="hideTip(event, 'fs37', 184)" onmouseover="showTip(event, 'fs37', 184)" class="i">tz</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs34', 185)" onmouseover="showTip(event, 'fs34', 185)" class="i">up</span> <span onmouseout="hideTip(event, 'fs37', 186)" onmouseover="showTip(event, 'fs37', 186)" class="i">tz</span>
  [&lt;<span onmouseout="hideTip(event, 'fs54', 187)" onmouseover="showTip(event, 'fs54', 187)" class="i">CustomOperation</span>(<span class="s">&quot;</span><span class="s">top</span><span class="s">&quot;</span>, <span class="i">MaintainsVariableSpace</span><span class="o">=</span><span class="k">true</span>)&gt;]
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 188)" onmouseover="showTip(event, 'fs48', 188)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs58', 189)" onmouseover="showTip(event, 'fs58', 189)" class="i">Top</span>(<span onmouseout="hideTip(event, 'fs37', 190)" onmouseover="showTip(event, 'fs37', 190)" class="i">tz</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs35', 191)" onmouseover="showTip(event, 'fs35', 191)" class="i">top</span> <span onmouseout="hideTip(event, 'fs37', 192)" onmouseover="showTip(event, 'fs37', 192)" class="i">tz</span>

  <span class="c">/// Extracts the current value and returns it</span>
  [&lt;<span onmouseout="hideTip(event, 'fs54', 193)" onmouseover="showTip(event, 'fs54', 193)" class="i">CustomOperation</span>(<span class="s">&quot;</span><span class="s">current</span><span class="s">&quot;</span>, <span class="i">MaintainsVariableSpace</span><span class="o">=</span><span class="k">false</span>)&gt;]
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 194)" onmouseover="showTip(event, 'fs48', 194)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 195)" onmouseover="showTip(event, 'fs59', 195)" class="i">Current</span>(<span onmouseout="hideTip(event, 'fs37', 196)" onmouseover="showTip(event, 'fs37', 196)" class="i">tz</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs29', 197)" onmouseover="showTip(event, 'fs29', 197)" class="i">current</span> <span onmouseout="hideTip(event, 'fs37', 198)" onmouseover="showTip(event, 'fs37', 198)" class="i">tz</span>

  <span class="c">/// Transform the current sub-tree using &#39;f&#39;</span>
  [&lt;<span onmouseout="hideTip(event, 'fs54', 199)" onmouseover="showTip(event, 'fs54', 199)" class="i">CustomOperation</span>(<span class="s">&quot;</span><span class="s">map</span><span class="s">&quot;</span>, <span class="i">MaintainsVariableSpace</span><span class="o">=</span><span class="k">true</span>)&gt;]
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs48', 200)" onmouseover="showTip(event, 'fs48', 200)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 201)" onmouseover="showTip(event, 'fs60', 201)" class="i">Select</span>(<span onmouseout="hideTip(event, 'fs37', 202)" onmouseover="showTip(event, 'fs37', 202)" class="i">tz</span>, [&lt;<span onmouseout="hideTip(event, 'fs61', 203)" onmouseover="showTip(event, 'fs61', 203)" class="i">ProjectionParameter</span>&gt;] <span onmouseout="hideTip(event, 'fs62', 204)" onmouseover="showTip(event, 'fs62', 204)" class="i">f</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs40', 205)" onmouseover="showTip(event, 'fs40', 205)" class="i">bindSub</span> (<span onmouseout="hideTip(event, 'fs62', 206)" onmouseover="showTip(event, 'fs62', 206)" class="i">f</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs38', 207)" onmouseover="showTip(event, 'fs38', 207)" class="i">unit</span>) <span onmouseout="hideTip(event, 'fs37', 208)" onmouseover="showTip(event, 'fs37', 208)" class="i">tz</span></pre>
</td>
</tr>
</table>

<p>The <code>MaintainsVariableSpace</code> parameter allows us to specify that an operation transforms
values in the abstract data type without touching them. If you have an operation
<code>M&lt;'T&gt; -&gt; M&lt;'T&gt;</code> then it is generally <code>true</code>, but if you have an operation such as
<code>M&lt;'T&gt; -&gt; M&lt;int&gt;</code> then the variable space would not be preserved (because variables
are stored in a tuple used in place of <code>'T</code>, so turning that to <code>int</code> loses the 
values in the tuple). In our case, navigation and transformation maintains the
variable space, but <code>current</code> operation does not.</p>

<p>The <code>map</code> operation uses another interesting attribute. If we annotate a function
argument with <code>ProjectionParameter</code> then we can write <code>map (x * 2)</code> and the argument
expression <code>x * 2</code> is implicitly turned into a function that takes all the variables
and returns the result. Something like <code>fun vars -&gt; vars.x * 2</code>.</p>

<h3>Sample tree computations</h3>

<p>Let's finish the article with two examples that process the <code>sample</code> tree defined 
earlier. The first one corresponds to our earlier computation (written using 
pipelines) that picks a specific leaf:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs53', 209)" onmouseover="showTip(event, 'fs53', 209)" class="i">tree</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs2', 210)" onmouseover="showTip(event, 'fs2', 210)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs32', 211)" onmouseover="showTip(event, 'fs32', 211)" class="i">sample</span> <span class="k">do</span>
       <span onmouseout="hideTip(event, 'fs63', 212)" onmouseover="showTip(event, 'fs63', 212)" class="k">right</span>
       <span onmouseout="hideTip(event, 'fs63', 213)" onmouseover="showTip(event, 'fs63', 213)" class="k">right</span>
       <span onmouseout="hideTip(event, 'fs64', 214)" onmouseover="showTip(event, 'fs64', 214)" class="k">left</span>
       <span onmouseout="hideTip(event, 'fs65', 215)" onmouseover="showTip(event, 'fs65', 215)" class="k">current</span> }</pre>
</td>
</tr>
</table>

<p>The computation expression syntax always has to start with <code>for .. in .. do</code>, so we
write that even if we do not actually access the value assigned to <code>x</code>. This is 
simply translated to <code>For</code> followed by <code>Yield</code> (which does not change the tree).</p>

<p>The <code>for</code> can then be followed by custom operations. In this example, we move
right, right, left and then get the current value from the tree. Note that adding
<code>left</code> after <code>current</code> gives a type error, because <code>current</code> extracts a value 
(which is not a tree zipper that can be transformed).</p>

<p>We can now also write the sample from the introduction of the article:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs53', 216)" onmouseover="showTip(event, 'fs53', 216)" class="i">tree</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs2', 217)" onmouseover="showTip(event, 'fs2', 217)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs32', 218)" onmouseover="showTip(event, 'fs32', 218)" class="i">sample</span> <span class="k">do</span>
       <span onmouseout="hideTip(event, 'fs64', 219)" onmouseover="showTip(event, 'fs64', 219)" class="k">left</span>
       <span onmouseout="hideTip(event, 'fs66', 220)" onmouseover="showTip(event, 'fs66', 220)" class="k">map</span> (<span onmouseout="hideTip(event, 'fs2', 221)" onmouseover="showTip(event, 'fs2', 221)" class="i">x</span> <span class="o">*</span> <span class="n">2</span>)
       <span onmouseout="hideTip(event, 'fs67', 222)" onmouseover="showTip(event, 'fs67', 222)" class="k">up</span>
       <span onmouseout="hideTip(event, 'fs63', 223)" onmouseover="showTip(event, 'fs63', 223)" class="k">right</span>
       <span onmouseout="hideTip(event, 'fs66', 224)" onmouseover="showTip(event, 'fs66', 224)" class="k">map</span> (<span onmouseout="hideTip(event, 'fs2', 225)" onmouseover="showTip(event, 'fs2', 225)" class="i">x</span> <span class="o">/</span> <span class="n">2</span>) 
       <span onmouseout="hideTip(event, 'fs68', 226)" onmouseover="showTip(event, 'fs68', 226)" class="k">top</span> }</pre>
</td>
</tr>
</table>

<p>Here, we write <code>for</code> followed by <code>left</code> to navigate to a left sub-tree. Then
we perform a transformation using <code>map</code>. Because this is implemented using the
<code>bindSub</code> operation, the transformation only affects the current sub-tree, but
not the parents (the root node and its right sub-tree).</p>

<p>This example is more interesting, because it actually uses the variable <code>x</code> in
the transformations (written using <code>map</code>). The computation expression notation 
actually gives us some benefits over a simple pipeline, because we do not need
to create an explicit lambda each time we write <code>map</code>. Thanks to <code>ProjectionParameter</code>
attribute, this is done automatically.</p>

<h2>Summary</h2>

<p>The main goal of this article is to demonstrate how you can define simple 
<em>computation expressions</em> with <em>custom operations</em> which is a new (and pretty powerful)
feature in F# 3.0. In the example discussed in this article, I used the <em>tree zipper</em>.</p>

<p>The custom operations make it possible to navigate through the tree using 
a conventient syntax and perform transformations on current sub-tree just by
writing commands like <code>left</code> and <code>right</code>. When writing the transformations using
<code>map (x / 2)</code> we also do not need to write explicit lambda functions.</p>

<p>This article is really just an introduction - there are many topics that I did 
not talk about, because the custom constructs can also implement operations that
resemble grouping or joining. But I'll leave that for another article!</p>

<div class="tip" id="fs1">val query : Linq.QueryBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.query</div>
<div class="tip" id="fs2">val x : int</div>
<div class="tip" id="fs3">custom operation: take (int)<br /><br />Calls Linq.QueryBuilder.Take </div>
<div class="tip" id="fs4">custom operation: sortByDescending (&#39;Key)<br /><br />Calls Linq.QueryBuilder.SortByDescending </div>
<div class="tip" id="fs5">type Tree&lt;&#39;T&gt; =<br />&#160;&#160;| Node of Tree&lt;&#39;T&gt; * Tree&lt;&#39;T&gt;<br />&#160;&#160;| Leaf of &#39;T<br />&#160;&#160;override ToString : unit -&gt; string<br /><br />Full name: Tree-zipper-query.aspx_.Tree&lt;_&gt;</div>
<div class="tip" id="fs6">union case Tree.Node: Tree&lt;&#39;T&gt; * Tree&lt;&#39;T&gt; -&gt; Tree&lt;&#39;T&gt;</div>
<div class="tip" id="fs7">union case Tree.Leaf: &#39;T -&gt; Tree&lt;&#39;T&gt;</div>
<div class="tip" id="fs8">val x : Tree&lt;&#39;T&gt;</div>
<div class="tip" id="fs9">override Tree.ToString : unit -&gt; string<br /><br />Full name: Tree-zipper-query.aspx_.Tree`1.ToString</div>
<div class="tip" id="fs10">match x with<br />&#160;&#160;&#160;&#160;| Node(l, r) -&gt; sprintf &quot;(%O, %O)&quot; l r<br />&#160;&#160;&#160;&#160;| Leaf v -&gt; sprintf &quot;%O&quot; v</div>
<div class="tip" id="fs11">type Path&lt;&#39;T&gt; =<br />&#160;&#160;| Top<br />&#160;&#160;| Left of Path&lt;&#39;T&gt; * Tree&lt;&#39;T&gt;<br />&#160;&#160;| Right of Path&lt;&#39;T&gt; * Tree&lt;&#39;T&gt;<br />&#160;&#160;override ToString : unit -&gt; string<br /><br />Full name: Tree-zipper-query.aspx_.Path&lt;_&gt;</div>
<div class="tip" id="fs12">union case Path.Top: Path&lt;&#39;T&gt;</div>
<div class="tip" id="fs13">union case Path.Left: Path&lt;&#39;T&gt; * Tree&lt;&#39;T&gt; -&gt; Path&lt;&#39;T&gt;</div>
<div class="tip" id="fs14">union case Path.Right: Path&lt;&#39;T&gt; * Tree&lt;&#39;T&gt; -&gt; Path&lt;&#39;T&gt;</div>
<div class="tip" id="fs15">val x : Path&lt;&#39;T&gt;</div>
<div class="tip" id="fs16">override Path.ToString : unit -&gt; string<br /><br />Full name: Tree-zipper-query.aspx_.Path`1.ToString</div>
<div class="tip" id="fs17">match x with<br />&#160;&#160;&#160;&#160;| Top -&gt; &quot;T&quot;<br />&#160;&#160;&#160;&#160;| Left(p, t) -&gt; sprintf &quot;L(%O, %O)&quot; p t<br />&#160;&#160;&#160;&#160;| Right(p, t) -&gt; sprintf &quot;R(%O, %O)&quot; p t</div>
<div class="tip" id="fs18">type TreeZipper&lt;&#39;T&gt; =<br />&#160;&#160;| TZ of Tree&lt;&#39;T&gt; * Path&lt;&#39;T&gt;<br />&#160;&#160;override ToString : unit -&gt; string<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipper&lt;_&gt;</div>
<div class="tip" id="fs19">union case TreeZipper.TZ: Tree&lt;&#39;T&gt; * Path&lt;&#39;T&gt; -&gt; TreeZipper&lt;&#39;T&gt;</div>
<div class="tip" id="fs20">val x : TreeZipper&lt;&#39;T&gt;</div>
<div class="tip" id="fs21">override TreeZipper.ToString : unit -&gt; string<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipper`1.ToString</div>
<div class="tip" id="fs22">let (TZ(t, p)) = x in sprintf &quot;%O [%O]&quot; t p</div>
<div class="tip" id="fs23">val left : _arg1:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.left<br /><em><br /><br />&#160;Navigates to the left sub-tree</em></div>
<div class="tip" id="fs24">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs25">val l : Tree&lt;&#39;a&gt;</div>
<div class="tip" id="fs26">val r : Tree&lt;&#39;a&gt;</div>
<div class="tip" id="fs27">val p : Path&lt;&#39;a&gt;</div>
<div class="tip" id="fs28">val right : _arg1:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.right<br /><em><br /><br />&#160;Navigates to the right sub-tree</em></div>
<div class="tip" id="fs29">val current : _arg1:TreeZipper&lt;&#39;a&gt; -&gt; &#39;a<br /><br />Full name: Tree-zipper-query.aspx_.current<br /><em><br /><br />&#160;Gets the value at the current position</em></div>
<div class="tip" id="fs30">val x : &#39;a</div>
<div class="tip" id="fs31">val branches : Tree&lt;int&gt;<br /><br />Full name: Tree-zipper-query.aspx_.branches</div>
<div class="tip" id="fs32">val sample : TreeZipper&lt;int&gt;<br /><br />Full name: Tree-zipper-query.aspx_.sample</div>
<div class="tip" id="fs33">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs34">val up : _arg1:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.up</div>
<div class="tip" id="fs35">val top : _arg1:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.top</div>
<div class="tip" id="fs36">val t : TreeZipper&lt;&#39;a&gt;</div>
<div class="tip" id="fs37">val tz : TreeZipper&lt;&#39;a&gt;</div>
<div class="tip" id="fs38">Multiple items<br />val unit : v:&#39;a -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.unit<br /><em><br /><br />&#160;Build tree zipper with singleton tree</em><br /><br />--------------------<br />type unit = Unit<br /><br />Full name: Microsoft.FSharp.Core.unit</div>
<div class="tip" id="fs39">val v : &#39;a</div>
<div class="tip" id="fs40">val bindSub : f:(&#39;a -&gt; TreeZipper&lt;&#39;a&gt;) -&gt; treeZip:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.bindSub<br /><em><br /><br />&#160;Transform leaves in the current sub-tree of &#39;treeZip&#39;<br />&#160;into other trees using the provided function &#39;f&#39;</em></div>
<div class="tip" id="fs41">val f : (&#39;a -&gt; TreeZipper&lt;&#39;a&gt;)</div>
<div class="tip" id="fs42">val treeZip : TreeZipper&lt;&#39;a&gt;</div>
<div class="tip" id="fs43">val bindT : (Tree&lt;&#39;a&gt; -&gt; Tree&lt;&#39;a&gt;)</div>
<div class="tip" id="fs44">val t : Tree&lt;&#39;a&gt;</div>
<div class="tip" id="fs45">val current : Tree&lt;&#39;a&gt;</div>
<div class="tip" id="fs46">val path : Path&lt;&#39;a&gt;</div>
<div class="tip" id="fs47">Multiple items<br />type TreeZipperBuilder =<br />&#160;&#160;new : unit -&gt; TreeZipperBuilder<br />&#160;&#160;member Current : tz:TreeZipper&lt;&#39;a&gt; -&gt; &#39;a<br />&#160;&#160;member For : tz:TreeZipper&lt;&#39;T&gt; * f:(&#39;T -&gt; TreeZipper&lt;&#39;T&gt;) -&gt; TreeZipper&lt;&#39;T&gt;<br />&#160;&#160;member Left : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br />&#160;&#160;member Right : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br />&#160;&#160;member Select : tz:TreeZipper&lt;&#39;a&gt; * f:(&#39;a -&gt; &#39;a) -&gt; TreeZipper&lt;&#39;a&gt;<br />&#160;&#160;member Top : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br />&#160;&#160;member Up : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br />&#160;&#160;member Yield : v:&#39;a -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder<br /><br />--------------------<br />new : unit -&gt; TreeZipperBuilder</div>
<div class="tip" id="fs48">val x : TreeZipperBuilder</div>
<div class="tip" id="fs49">member TreeZipperBuilder.For : tz:TreeZipper&lt;&#39;T&gt; * f:(&#39;T -&gt; TreeZipper&lt;&#39;T&gt;) -&gt; TreeZipper&lt;&#39;T&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.For<br /><em><br /><br />&#160;Enables the &#39;for x in xs do ..&#39; syntax</em></div>
<div class="tip" id="fs50">val tz : TreeZipper&lt;&#39;T&gt;</div>
<div class="tip" id="fs51">val f : (&#39;T -&gt; TreeZipper&lt;&#39;T&gt;)</div>
<div class="tip" id="fs52">member TreeZipperBuilder.Yield : v:&#39;a -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.Yield<br /><em><br /><br />&#160;Enables the &#39;yield x&#39; syntax</em></div>
<div class="tip" id="fs53">val tree : TreeZipperBuilder<br /><br />Full name: Tree-zipper-query.aspx_.tree<br /><em><br /><br />&#160;Global instance of the computation builder</em></div>
<div class="tip" id="fs54">Multiple items<br />type CustomOperationAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : name:string -&gt; CustomOperationAttribute<br />&#160;&#160;member AllowIntoPattern : bool<br />&#160;&#160;member IsLikeGroupJoin : bool<br />&#160;&#160;member IsLikeJoin : bool<br />&#160;&#160;member IsLikeZip : bool<br />&#160;&#160;member JoinConditionWord : string<br />&#160;&#160;member MaintainsVariableSpace : bool<br />&#160;&#160;member MaintainsVariableSpaceUsingBind : bool<br />&#160;&#160;member Name : string<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Core.CustomOperationAttribute<br /><br />--------------------<br />new : name:string -&gt; CustomOperationAttribute</div>
<div class="tip" id="fs55">member TreeZipperBuilder.Left : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.Left</div>
<div class="tip" id="fs56">member TreeZipperBuilder.Right : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.Right</div>
<div class="tip" id="fs57">member TreeZipperBuilder.Up : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.Up</div>
<div class="tip" id="fs58">member TreeZipperBuilder.Top : tz:TreeZipper&lt;&#39;a&gt; -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.Top</div>
<div class="tip" id="fs59">member TreeZipperBuilder.Current : tz:TreeZipper&lt;&#39;a&gt; -&gt; &#39;a<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.Current<br /><em><br /><br />&#160;Extracts the current value and returns it</em></div>
<div class="tip" id="fs60">member TreeZipperBuilder.Select : tz:TreeZipper&lt;&#39;a&gt; * f:(&#39;a -&gt; &#39;a) -&gt; TreeZipper&lt;&#39;a&gt;<br /><br />Full name: Tree-zipper-query.aspx_.TreeZipperBuilder.Select<br /><em><br /><br />&#160;Transform the current sub-tree using &#39;f&#39;</em></div>
<div class="tip" id="fs61">Multiple items<br />type ProjectionParameterAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; ProjectionParameterAttribute<br /><br />Full name: Microsoft.FSharp.Core.ProjectionParameterAttribute<br /><br />--------------------<br />new : unit -&gt; ProjectionParameterAttribute</div>
<div class="tip" id="fs62">val f : (&#39;a -&gt; &#39;a)</div>
<div class="tip" id="fs63">custom operation: right<br /><br />Calls TreeZipperBuilder.Right </div>
<div class="tip" id="fs64">custom operation: left<br /><br />Calls TreeZipperBuilder.Left </div>
<div class="tip" id="fs65">custom operation: current<br /><br />Calls TreeZipperBuilder.Current <br /><em><br /><br />&#160;Extracts the current value and returns it</em></div>
<div class="tip" id="fs66">custom operation: map (&#39;a)<br /><br />Calls TreeZipperBuilder.Select <br /><em><br /><br />&#160;Transform the current sub-tree using &#39;f&#39;</em></div>
<div class="tip" id="fs67">custom operation: up<br /><br />Calls TreeZipperBuilder.Up </div>
<div class="tip" id="fs68">custom operation: top<br /><br />Calls TreeZipperBuilder.Top </div>


<div class="row">
  <div class="small-6 columns"><p class="post-discuss">
		Discuss <a href="http://twitter.com/tomaspetricek">on twitter</a>, <script type="text/javascript" src="http://www.reddit.com/buttonlite.js?i=0"></script>.<br />
		Send corrections via <a href="https://github.com/tpetricek/TomaspNet.Website">GitHub pull requests</a>.
	</p></div>
  <div class="small-6 columns">

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_twitter"></a>
<a class="addthis_button_reddit"></a>
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_hackernews"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = { "data_track_addressbar": false };</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-521c32162e6001a0"></script>
<!-- AddThis Button END -->

<p class="post-meta">
  <span><strong>Published</strong> Wednesday, 19 December 2012, 2:22 PM</span><br />      
  <span><strong>By</strong> <a href="https://plus.google.com/+TomasPetriceks?rel=author">Tomas Petricek</a></span><br />
  <span class="tags"><strong>Tags</strong> f#, haskell, research, monads, linq</span>
</p>

  </div>
</div>

    </content>

  </div>
  <div class="large-4 columns" id="right-bar">
    <div class="right-item" id="right-calendar">
<script type="text/javascript">
  var monthNames =
    ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"];
  var d = new Date();
  var m = monthNames[d.getMonth()];
  var y = d.getFullYear();
  var ml = m.toLowerCase();
  document.writeln("<h4>Calendar - " + m + " " + y + "</h4>");
  document.writeln("<a href=\"http://tomasp.net/calendar/" + y + "/" + ml + ".html\">" +
    "<img src=\"http://tomasp.net/calendar/" + y + "/" + ml + "-preview.jpg\" style=\"border-style:none;\" />" +
    "</a>");
</script> 
<p>The calendar shows a new picture each month. See photos for
  <a href="http://tomasp.net/calendar/2005">2005</a>, <a href="http://tomasp.net/calendar/2006">2006</a>, 
  <a href="http://tomasp.net/calendar/2007">2007</a>, <a href="http://tomasp.net/calendar/2008">2008</a>, 
  <a href="http://tomasp.net/calendar/2009">2009</a>, <a href="http://tomasp.net/calendar/2010">2010</a>, 
  <a href="http://tomasp.net/calendar/2011">2011</a>, <a href="http://tomasp.net/calendar/2012">2012</a>,
  <a href="http://tomasp.net/calendar/2013">2013</a>, <a href="http://tomasp.net/calendar/2014">2014</a>
  and the first photos of <a href="http://tomasp.net/calendar/2015">2015</a>.
</p>
</div>

    <h3>Welcome!</h3>
    <img src="http://tomasp.net/img/tomas.jpg" alt="Tomas Petricek" style="float:right;margin:10px 0px 10px 10px;" />
    <p>I'm an F# open-source developer, book author and computer scientist. I submitted my PhD thesis recently.
      When offline, I enjoy traveling and taking pictures. You can find me at
      at <a href="http://twitter.com/tomaspetricek">@tomaspetricek</a> or email 
      <a href="mailto:tomas@tomasp.net">tomas@tomasp.net</a>.
    </p>

    <h4>Trainings and consulting</h4>
    <a href="http://fsharpworks.com"><img src="http://tomasp.net/img/fsharpworks.png" alt="fsharpWorks" style="float:right;margin:15px 0px 10px 10px; width:150px" /></a>
    <p>I'm an experienced F# developer and trainer. <br /> I offer training and consulting
      services through <a href="http://fsharpworks.com">fsharpWorks</a>.
    </p>
    <ul>
      <li>Check out my <a href="http://fsharpworks.com/workshops/fast-track.html">in-person Fast Track to F#</a> course</li>
      <li>Check out my <a href="http://fsharpworks.com/workshops/finance.html">online F# in Finance</a> course</li>
      <li><a href="mailto:tomas@tomasp.net">Email me</a> for info about private trainings</li>
    </ul>
    
    <script type="text/javascript" src="http://tomasp.net/news/news.js"></script>
    <h4>What's new? &#160; <small><script type="text/javascript">document.write(news.date)</script></small></h4>
    <script>
      document.write(news.info);
    </script>

    <h4>Functional F# and C# books</h4>
    <div style="float:right;">
      <a href="http://www.amazon.com/gp/product/1933988924/ref=as_li_tf_il?ie=UTF8&amp;tag=httptomasnet-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399369&amp;creativeASIN=1933988924">
        <img src="http://tomasp.net/img/deepdives.png" alt="F# Deep Dives" style="float:right;margin:15px 0px 15px 10px;border-style:none;" />
      </a>
    </div>
    <p>
      I wrote or contributed to two books on F# and functional programming:
      <a href="http://functional-programming.net/rwfp">Real World Functional Programming</a> explains functional
      concepts using F# and C# and <a href="http://functional-programming.net/deepdives">F# Deep Dives</a> is a 
      collection of case studies written by industry experts.</p>
    <ul>
      <li><a href="http://functional-programming.net/rwfp"><strong>Real World Functional Programming</strong></a> home page. See
        <a href="http://manning.com/petricek">Manning</a>,
        <a href="https://www.amazon.com/dp/1933988924?tag=httptomasnet-20&amp;camp=213381&amp;creative=390973&amp;linkCode=as4&amp;creativeASIN=1933988924&amp;adid=0F1DP260JGG4KY0CDGP6">Amazon.com</a> or
        <a href="https://www.amazon.co.uk/dp/1933988924?tag=tomasnet-21&amp;camp=1406&amp;creative=6394&amp;linkCode=as1&amp;creativeASIN=1933988924&amp;adid=1CTY87YCCQEJW965GNDF">Amazon.co.uk</a>.
      </li>
      <li><a href="http://functional-programming.net/deepdives"><strong>F# Deep Dives</strong></a> home page. Get it from
        <a href="http://www.manning.com/petricek2">Manning.com</a>,
        <a href="http://www.amazon.com/gp/product/1617291323/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1617291323&linkCode=as2&tag=httptomasnet-20&linkId=U4FPJJSKKCCKGNHD">Amazon.com</a> or
        <a href="http://www.amazon.co.uk/gp/product/1617291323/ref=as_li_tl?ie=UTF8&camp=1634&creative=19450&creativeASIN=1617291323&linkCode=as2&tag=tomasnet-21&linkId=HTUYVHHGWB4Q7X6V">Amazon.co.uk</a>.
      </li>
    </ul>    
    <p>I also wrote a series of tutorials on <a href="http://www.tryfsharp.org/Learn/financial-computing">financial computing for Try F#</a>.
      This interactive environment let's you try F# in the browser.</p>

    <h4>Research and teaching</h4>
    <img src="http://tomasp.net/img/cam.png" alt="University of Cambride" style="float:right;margin:25px 0px 10px 10px;" />
    <p>I submitted my PhD thesis at the <a href="http://www.cl.cam.ac.uk/">University of Cambridge</a>,
      working on making better types for programs that run in rich context (like F# type providers, distributed 
      prog&shy;ramming or data-flow). See <a href="http://tomasp.net/academic/">my academic page</a> for
      more.</p>

    <h4>Blog tags</h4>
    <p>

      <a href="http://tomasp.net/blog/tag/fsharp/">f#</a>&nbsp;(102),       <a href="http://tomasp.net/blog/tag/csharp/">c#</a>&nbsp;(35),       <a href="http://tomasp.net/blog/tag/functional-programming/">functional programming</a>&nbsp;(15),       <a href="http://tomasp.net/blog/tag/research/">research</a>&nbsp;(29),       <a href="http://tomasp.net/blog/tag/talks/">talks</a>&nbsp;(5),       <a href="http://tomasp.net/blog/tag/open-source/">open source</a>&nbsp;(5),       <a href="http://tomasp.net/blog/tag/fun/">fun</a>&nbsp;(4),       <a href="http://tomasp.net/blog/tag/data-science/">data science</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/linq/">linq</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/monads/">monads</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/fslab/">fslab</a>&nbsp;(1),       <a href="http://tomasp.net/blog/tag/deedle/">deedle</a>&nbsp;(1)    </p>

  </div>
</div>


  <div class="row" id="footer">
  <footer>   
    <div class="large-3 columns">
      <h4>Contact &amp; about</h4>
      <p>This site is hosted on GitHub and is generated using <a href="https://github.com/tpetricek/FSharp.Formatting">F# Formatting</a>.
        For more info, see the <a href="https://github.com/tpetricek/TomaspNet.Website">website source on GitHub</a>.
      </p>
      <p>Please submit issues &amp; corrections on GitHub. Use pull requests for minor corrections only.</p>
      <ul>
        <li>Email me: <a href="mailto:tomas@tomasp.net">tomas@tomasp.net</a></li>
        <li>Connect via Twitter: <a href="http://twitter.com/tomaspetricek">@tomaspetricek</a></li>
        <li>More: <a href="http://uk.linkedin.com/in/tomaspetricek">LinkedIn</a> | <a href="http://lanyrd.com/profile/tomasp/">Lanyrd</a> | <a href="https://github.com/tpetricek">GitHub</a></li>
      </ul>
    </div>
    <div class="large-7 columns">
    <h4>Blog archives <a href="http://tomasp.net/rss.xml"><img src="http://tomasp.net/img/rss.gif" /></a></h4>
      <a href="http://tomasp.net/blog/archive/april-2015/index.html">
        April 2015 (2)</a>,      <a href="http://tomasp.net/blog/archive/march-2015/index.html">
        March 2015 (2)</a>,      <a href="http://tomasp.net/blog/archive/february-2015/index.html">
        February 2015 (1)</a>,      <a href="http://tomasp.net/blog/archive/january-2015/index.html">
        January 2015 (2)</a>,      <a href="http://tomasp.net/blog/archive/december-2014/index.html">
        December 2014 (1)</a>,      <a href="http://tomasp.net/blog/archive/may-2014/index.html">
        May 2014 (3)</a>,      <a href="http://tomasp.net/blog/archive/april-2014/index.html">
        April 2014 (2)</a>,      <a href="http://tomasp.net/blog/archive/march-2014/index.html">
        March 2014 (1)</a>,      <a href="http://tomasp.net/blog/archive/january-2014/index.html">
        January 2014 (2)</a>,      <a href="http://tomasp.net/blog/archive/december-2013/index.html">
        December 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/november-2013/index.html">
        November 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/october-2013/index.html">
        October 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/september-2013/index.html">
        September 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/august-2013/index.html">
        August 2013 (2)</a>,      <a href="http://tomasp.net/blog/archive/may-2013/index.html">
        May 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/april-2013/index.html">
        April 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2013/index.html">
        March 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/february-2013/index.html">
        February 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/january-2013/index.html">
        January 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2012/index.html">
        December 2012 (2)</a>,      <a href="http://tomasp.net/blog/archive/october-2012/index.html">
        October 2012 (1)</a>,      <a href="http://tomasp.net/blog/archive/august-2012/index.html">
        August 2012 (3)</a>,      <a href="http://tomasp.net/blog/archive/june-2012/index.html">
        June 2012 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2012/index.html">
        April 2012 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2012/index.html">
        March 2012 (4)</a>,      <a href="http://tomasp.net/blog/archive/february-2012/index.html">
        February 2012 (5)</a>,      <a href="http://tomasp.net/blog/archive/january-2012/index.html">
        January 2012 (2)</a>,      <a href="http://tomasp.net/blog/archive/november-2011/index.html">
        November 2011 (5)</a>,      <a href="http://tomasp.net/blog/archive/august-2011/index.html">
        August 2011 (3)</a>,      <a href="http://tomasp.net/blog/archive/july-2011/index.html">
        July 2011 (2)</a>,      <a href="http://tomasp.net/blog/archive/june-2011/index.html">
        June 2011 (2)</a>,      <a href="http://tomasp.net/blog/archive/may-2011/index.html">
        May 2011 (2)</a>,      <a href="http://tomasp.net/blog/archive/march-2011/index.html">
        March 2011 (4)</a>,      <a href="http://tomasp.net/blog/archive/december-2010/index.html">
        December 2010 (1)</a>,      <a href="http://tomasp.net/blog/archive/november-2010/index.html">
        November 2010 (6)</a>,      <a href="http://tomasp.net/blog/archive/october-2010/index.html">
        October 2010 (6)</a>,      <a href="http://tomasp.net/blog/archive/september-2010/index.html">
        September 2010 (4)</a>,      <a href="http://tomasp.net/blog/archive/july-2010/index.html">
        July 2010 (3)</a>,      <a href="http://tomasp.net/blog/archive/june-2010/index.html">
        June 2010 (2)</a>,      <a href="http://tomasp.net/blog/archive/may-2010/index.html">
        May 2010 (1)</a>,      <a href="http://tomasp.net/blog/archive/february-2010/index.html">
        February 2010 (2)</a>,      <a href="http://tomasp.net/blog/archive/january-2010/index.html">
        January 2010 (3)</a>,      <a href="http://tomasp.net/blog/archive/december-2009/index.html">
        December 2009 (3)</a>,      <a href="http://tomasp.net/blog/archive/july-2009/index.html">
        July 2009 (1)</a>,      <a href="http://tomasp.net/blog/archive/june-2009/index.html">
        June 2009 (3)</a>,      <a href="http://tomasp.net/blog/archive/may-2009/index.html">
        May 2009 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2009/index.html">
        April 2009 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2009/index.html">
        March 2009 (2)</a>,      <a href="http://tomasp.net/blog/archive/february-2009/index.html">
        February 2009 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2008/index.html">
        December 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/november-2008/index.html">
        November 2008 (5)</a>,      <a href="http://tomasp.net/blog/archive/october-2008/index.html">
        October 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/september-2008/index.html">
        September 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/june-2008/index.html">
        June 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2008/index.html">
        March 2008 (3)</a>,      <a href="http://tomasp.net/blog/archive/february-2008/index.html">
        February 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2007/index.html">
        December 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/november-2007/index.html">
        November 2007 (6)</a>,      <a href="http://tomasp.net/blog/archive/october-2007/index.html">
        October 2007 (1)</a>,      <a href="http://tomasp.net/blog/archive/september-2007/index.html">
        September 2007 (1)</a>,      <a href="http://tomasp.net/blog/archive/august-2007/index.html">
        August 2007 (1)</a>,      <a href="http://tomasp.net/blog/archive/july-2007/index.html">
        July 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2007/index.html">
        April 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/march-2007/index.html">
        March 2007 (3)</a>,      <a href="http://tomasp.net/blog/archive/february-2007/index.html">
        February 2007 (3)</a>,      <a href="http://tomasp.net/blog/archive/january-2007/index.html">
        January 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/november-2006/index.html">
        November 2006 (1)</a>,      <a href="http://tomasp.net/blog/archive/october-2006/index.html">
        October 2006 (3)</a>,      <a href="http://tomasp.net/blog/archive/august-2006/index.html">
        August 2006 (2)</a>,      <a href="http://tomasp.net/blog/archive/july-2006/index.html">
        July 2006 (1)</a>,      <a href="http://tomasp.net/blog/archive/june-2006/index.html">
        June 2006 (3)</a>,      <a href="http://tomasp.net/blog/archive/may-2006/index.html">
        May 2006 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2006/index.html">
        April 2006 (2)</a>,      <a href="http://tomasp.net/blog/archive/december-2005/index.html">
        December 2005 (1)</a>,      <a href="http://tomasp.net/blog/archive/july-2005/index.html">
        July 2005 (4)</a>,      <a href="http://tomasp.net/blog/archive/june-2005/index.html">
        June 2005 (5)</a>,      <a href="http://tomasp.net/blog/archive/may-2005/index.html">
        May 2005 (1)</a>,      <a href="http://tomasp.net/blog/archive/april-2005/index.html">
        April 2005 (3)</a>,      <a href="http://tomasp.net/blog/archive/march-2005/index.html">
        March 2005 (3)</a>,      <a href="http://tomasp.net/blog/archive/january-2005/index.html">
        January 2005 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2004/index.html">
        December 2004 (3)</a>,      <a href="http://tomasp.net/blog/archive/november-2004/index.html">
        November 2004 (2)</a>,    </div>
    <div class="large-2 columns">
      <h4>License</h4>
      <p>Unless explicitly mentioned, all articles on this site are licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution Share Alike</a>. 
        All source code samples are licensed under Apache 2.0.
      </p>
      <img src="http://tomasp.net/img/cc-sa.png" alt="CC License logo" />
    </div>
  </footer>
  </div>
  
  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'http://tomasp.net/js/vendor/zepto' : 'http://tomasp.net/js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="http://tomasp.net/js/foundation.min.js"></script>
  <script>
    $(document).foundation();
  </script>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1561220-1']);
    _gaq.push(['_trackPageview']);

    (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
  <script src="http://cdn.lanyrd.net/badges/person-v1.min.js"></script>
</body>
</html>